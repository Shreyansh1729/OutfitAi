<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OutfitAI Recommendation</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #5a5a5a; }
        label { display: block; margin-top: 10px; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], select, textarea { width: calc(100% - 22px); padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        input[type="file"] { padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; display: block; }
        input[type="submit"] { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        input[type="submit"]:hover { background-color: #0056b3; }
        .error { color: red; font-weight: bold; margin-bottom: 15px; }
        .recommendation { margin-top: 20px; padding: 15px; border: 1px solid #eee; border-radius: 4px; background-color: #f9f9f9; }
        .recommendation h3 { margin-top: 0; color: #007bff; }
        .recommendation ul { list-style-type: none; padding-left: 0; }
        .recommendation li { background-color: #fff; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .recommendation p { margin-top: 5px; }
        .recommendation a { color: #0056b3; text-decoration: none; }
        .recommendation a:hover { text-decoration: underline; }
        .item-image-link img { max-width: 100px; max-height: 100px; border: 1px solid #ccc; margin-right: 10px; vertical-align: middle;}
    </style>
</head>
<body>
    <div class="container">
        <h1>OutfitAI - Get an Outfit Recommendation</h1>

        {% if error_message %}
            <p class="error">{{ error_message }}</p>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            <label for="user_id_str">Select User:</label>
            <select name="user_id_str" id="user_id_str" required>
                <option value="">-- Select a User --</option>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if selected_user_id and selected_user_id == user.id|string %}selected{% endif %}>
                        {{ user.username or user.email }} (ID: {{ user.id }})
                    </option>
                {% endfor %}
            </select>
            {% if not users %}
                <p>No users found. Please create a user via the API at <a href="/docs#/Users/create_user_endpoint_api_v1_users__post" target="_blank">/docs</a>.</p>
            {% endif %}

            <label for="event_type">Event/Occasion:</label>
            <input type="text" name="event_type" id="event_type" value="{{ event_type_val or '' }}" required>

            <label for="style_goal">Desired Style/Mood (Optional):</label>
            <textarea name="style_goal" id="style_goal" rows="3">{{ style_goal_val or '' }}</textarea>
            
            <label for="inspirational_image">Inspirational Image (Optional):</label>
            <input type="file" name="inspirational_image" id="inspirational_image" accept="image/*">

            <input type="submit" value="Get Recommendation">
        </form>

        {% if recommendation %}
            <div class="recommendation">
                <h2>AI Recommendation:</h2>
                <p><strong>For Event:</strong> {{ recommendation.event_type_context }}</p>
                {% if recommendation.style_goal_context %}
                    <p><strong>Style Goal:</strong> {{ recommendation.style_goal_context }}</p>
                {% endif %}
                 {% if recommendation.inspirational_image_url_context %}
                    <p><strong>Based on Inspiration (Conceptual URL/Path):</strong> {{ recommendation.inspirational_image_url_context }}</p>
                {% endif %}

                <h3>Suggested Components:</h3>
                <ul>
                    {% for component in recommendation.components %}
                    <li>
                        <strong>{{ component.item_category.value }}:</strong> {{ component.description }}
                        {% if component.product_store_url or component.product_image_url %}
                            <p>
                                {% if component.product_store_url %}
                                    <a href="{{ component.product_store_url }}" target="_blank">Find Similar Items (Shop)</a>
                                {% endif %}
                                {% if component.product_image_url %}
                                    | <a href="{{ component.product_image_url }}" target="_blank">See Similar Images</a>
                                {% endif %}
                            </p>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% if recommendation.overall_reasoning %}
                    <p><strong>Stylist's Reasoning:</strong> {{ recommendation.overall_reasoning }}</p>
                {% endif %}
                 <p><small>Recommendation ID: {{ recommendation.id }}</small></p>
                 {# Add a simple form to save this recommendation #}
                 <form method="POST" action="/api/v1/users/{{ recommendation.user_id }}/saved-outfits/"> 
                    {# This action will be a plain form post, not AJAX, will need frontend JS for better UX #}
                    {# For a pure AJAX call, the action URL and method would be handled by JavaScript #}
                    {# The following inputs are examples of what you'd send for saving #}
                    <input type="hidden" name="original_recommendation_id" value="{{ recommendation.id }}">
                    <input type="hidden" name="user_id_for_save" value="{{ recommendation.user_id }}">
                    <label for="rating-{{recommendation.id}}">Rate this (1-5, optional):</label>
                    <input type="number" name="user_rating" id="rating-{{recommendation.id}}" min="1" max="5" style="width: 60px;">
                    <br>
                    <label for="notes-{{recommendation.id}}">Notes (optional):</label>
                    <textarea name="user_notes" id="notes-{{recommendation.id}}" rows="2"></textarea>
                    <br>
                    {# This simple save will try to POST directly to API. Better UX uses JS.
                       For now, this form will likely not work well without JS to construct the proper JSON body.
                       Let's remove this save form part for now to keep HTML clean.
                       Saving would be done via API directly using recommendation.id
                    #}
                    {# <input type="submit" value="Save This Outfit"> #}
                 </form>
            </div>
        {% endif %}
    </div>
</body>
</html>